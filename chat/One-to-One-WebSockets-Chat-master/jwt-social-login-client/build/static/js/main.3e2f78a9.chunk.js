(this["webpackJsonpjwt-social-login-client"]=this["webpackJsonpjwt-social-login-client"]||[]).push([[0],{197:function(e,t,a){e.exports=a(453)},226:function(e,t,a){},227:function(e,t,a){},359:function(e,t,a){},360:function(e,t,a){},412:function(e,t,a){},451:function(e,t,a){},453:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),c=a.n(s),l=a(30),o=a(172),i=(a(226),a(191)),m=a(18),u=a(31),d=a(460),g=a(457),p=a(459),f=a(120),E=a(454),h=a(461),v=a(462),y=a(463),b=a(464),S="http://localhost:8081",w=function(e){var t=new Headers;!1!==e.setContentType&&t.append("Content-Type","application/json"),localStorage.getItem("accessToken")&&t.append("Authorization","Bearer "+localStorage.getItem("accessToken"));var a={headers:t};return e=Object.assign({},a,e),fetch(e.url,e).then((function(e){return e.json().then((function(t){return e.ok?t:Promise.reject(t)}))}))};a(227);var O=function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),s=a[0],c=a[1],l=Object(n.useState)(!1),o=Object(u.a)(l,2),i=o[0],m=o[1],O=Object(n.useState)(localStorage.getItem("accessToken")),k=Object(u.a)(O,2),j=k[0];k[1];Object(n.useEffect)((function(){null!==localStorage.getItem("accessToken")&&e.history.push("/"),I()}),[]),Object(n.useEffect)((function(){I()}),[j]);var I=function(){window.fbAsyncInit=function(){FB.init({appId:"118319422120166",autoLogAppEvents:!0,xfbml:!0,version:"v7.0"})}};return r.a.createElement("div",{className:"login-container"},r.a.createElement(h.a,{style:{fontSize:50}}),r.a.createElement(g.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(t){var a;c(!0),(a=t,w({url:S+"/signin",method:"POST",body:JSON.stringify(a)})).then((function(t){localStorage.setItem("accessToken",t.accessToken),e.history.push("/chat"),c(!1)})).catch((function(e){401===e.status?d.a.error({message:"Error",description:"Username or Password is incorrect. Please try again!"}):d.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),c(!1)}))}},r.a.createElement(g.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},r.a.createElement(p.a,{size:"large",prefix:r.a.createElement(v.a,{className:"site-form-item-icon"}),placeholder:"Username"})),r.a.createElement(g.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},r.a.createElement(p.a,{size:"large",prefix:r.a.createElement(y.a,{className:"site-form-item-icon"}),type:"password",placeholder:"Password"})),r.a.createElement(g.a.Item,null,r.a.createElement(f.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:s},"Log in")),r.a.createElement(E.a,null,"OR"),r.a.createElement(g.a.Item,null,r.a.createElement(f.a,{icon:r.a.createElement(b.a,{style:{fontSize:20}}),loading:i,className:"login-with-facebook",shape:"round",size:"large",onClick:function(){m(!0),FB.login((function(t){"connected"===t.status?function(e){return w({url:S+"/facebook/signin",method:"POST",body:JSON.stringify(e)})}({accessToken:t.authResponse.accessToken}).then((function(t){localStorage.setItem("accessToken",t.accessToken),e.history.push("/"),m(!1)})).catch((function(e){401===e.status?d.a.error({message:"Error",description:"Invalid credentials"}):d.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),m(!1)})):console.log(t)}),{scope:"email"})}},"Log in With Facebook")),"Not a member yet? ",r.a.createElement("a",{href:"/signup"},"Sign up")))},k=(a(359),function(e){var t=Object(n.useState)(!1),a=Object(u.a)(t,2),s=a[0],c=a[1];Object(n.useEffect)((function(){null!==localStorage.getItem("accessToken")&&e.history.push("/")}),[]);return r.a.createElement("div",{className:"login-container"},r.a.createElement(h.a,{style:{fontSize:50}}),r.a.createElement(g.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(t){var a;c(!0),(a=t,w({url:S+"/users",method:"POST",body:JSON.stringify(a)})).then((function(t){d.a.success({message:"Success",description:"Thank you! You're successfully registered. Please Login to continue!"}),e.history.push("/login"),c(!1)})).catch((function(e){d.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),c(!1)}))}},r.a.createElement(g.a.Item,{name:"name",rules:[{required:!0,message:"Please input your name!"}]},r.a.createElement(p.a,{size:"large",placeholder:"Name"})),r.a.createElement(g.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},r.a.createElement(p.a,{size:"large",placeholder:"Username"})),r.a.createElement(g.a.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"}]},r.a.createElement(p.a,{size:"large",placeholder:"Email"})),r.a.createElement(g.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},r.a.createElement(p.a,{size:"large",type:"password",placeholder:"Password"})),r.a.createElement(g.a.Item,{name:"profilePicUrl",rules:[{required:!0,message:"Please input your profile picture URL!"}]},r.a.createElement(p.a,{size:"large",placeholder:"Profile picture url"})),r.a.createElement(g.a.Item,null,r.a.createElement(f.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:s},"Signup")),"Already a member? ",r.a.createElement("a",{href:"/login"},"Log in")))}),j=a(458),I=a(455),P=Object(l.atom)({key:"loggedInUser",default:{},persistence_UNSTABLE:{type:"loggedInUser"}}),T=Object(l.atom)({key:"chatActiveContact",persistence_UNSTABLE:{type:"chatActiveContact"}}),N=Object(l.atom)({key:"chatMessages",default:[],persistence_UNSTABLE:{type:"chatMessages"}}),z=a(465),A=(a(360),j.a.Meta),U=function(e){var t=Object(l.useRecoilState)(P),a=Object(u.a)(t,2),s=a[0],c=a[1];Object(n.useEffect)((function(){null===localStorage.getItem("accessToken")&&e.history.push("/login"),o()}),[]);var o=function(){(localStorage.getItem("accessToken")?w({url:S+"/users/me",method:"GET"}):Promise.reject("No access token set.")).then((function(e){c(e)})).catch((function(e){console.log(e)}))};return r.a.createElement("div",{className:"profile-container"},r.a.createElement(j.a,{style:{width:420,border:"1px solid #e1e0e0"},actions:[r.a.createElement(z.a,{onClick:function(){localStorage.removeItem("accessToken"),e.history.push("/login")}})]},r.a.createElement(A,{avatar:r.a.createElement(I.a,{src:s.profilePicture,className:"user-avatar-circle"}),title:s.name,description:"@"+s.username})))},C=a(193),R=a(456),x=a(189),B=a.n(x),J=(a(412),null),L=function(e){var t=Object(l.useRecoilValue)(P),s=Object(n.useState)(""),c=Object(u.a)(s,2),o=c[0],i=c[1],m=Object(n.useState)([]),d=Object(u.a)(m,2),g=d[0],p=d[1],E=Object(l.useRecoilState)(T),h=Object(u.a)(E,2),v=h[0],y=h[1],b=Object(l.useRecoilState)(N),O=Object(u.a)(b,2),k=O[0],j=O[1];Object(n.useEffect)((function(){null===localStorage.getItem("accessToken")&&e.history.push("/login"),I(),L()}),[]),Object(n.useEffect)((function(){var e,a;void 0!==v&&((e=v.id,a=t.id,localStorage.getItem("accessToken")?w({url:"http://localhost:8080/messages/"+e+"/"+a,method:"GET"}):Promise.reject("No access token set.")).then((function(e){return j(e)})),L())}),[v]);var I=function(){var e=a(413),t=a(420);t=new t("http://localhost:8080/ws"),(J=e.over(t)).connect({},z,A)},z=function(){console.log("connected"),console.log(t),J.subscribe("/user/"+t.id+"/queue/messages",U)},A=function(e){console.log(e)},U=function(e){var t,a=JSON.parse(e.body);JSON.parse(sessionStorage.getItem("recoil-persist")).chatActiveContact.id===a.senderId?(t=a.id,localStorage.getItem("accessToken")?w({url:"http://localhost:8080/messages/"+t,method:"GET"}):Promise.reject("No access token set.")).then((function(e){var t=JSON.parse(sessionStorage.getItem("recoil-persist")).chatMessages;t.push(e),j(t)})):R.a.info("Received a new message from "+a.senderName),L()},x=function(e){if(""!==e.trim()){var a={senderId:t.id,recipientId:v.id,senderName:t.name,recipientName:v.name,content:e,timestamp:new Date};J.send("/app/chat",{},JSON.stringify(a));var n=Object(C.a)(k);n.push(a),j(n)}},L=function(){(localStorage.getItem("accessToken")?w({url:S+"/users/summaries",method:"GET"}):Promise.reject("No access token set.")).then((function(e){return e.map((function(e){return(a=e.id,n=t.id,localStorage.getItem("accessToken")?w({url:"http://localhost:8080/messages/"+a+"/"+n+"/count",method:"GET"}):Promise.reject("No access token set.")).then((function(t){return e.newMessages=t,e}));var a,n}))})).then((function(e){return Promise.all(e).then((function(e){p(e),void 0===v&&e.length>0&&y(e[0])}))}))};return r.a.createElement("div",{id:"frame"},r.a.createElement("div",{id:"sidepanel"},r.a.createElement("div",{id:"profile"},r.a.createElement("div",{class:"wrap"},r.a.createElement("img",{id:"profile-img",src:t.profilePicture,class:"online",alt:""}),r.a.createElement("p",null,t.name),r.a.createElement("div",{id:"status-options"},r.a.createElement("ul",null,r.a.createElement("li",{id:"status-online",class:"active"},r.a.createElement("span",{class:"status-circle"})," ",r.a.createElement("p",null,"Online")),r.a.createElement("li",{id:"status-away"},r.a.createElement("span",{class:"status-circle"})," ",r.a.createElement("p",null,"Away")),r.a.createElement("li",{id:"status-busy"},r.a.createElement("span",{class:"status-circle"})," ",r.a.createElement("p",null,"Busy")),r.a.createElement("li",{id:"status-offline"},r.a.createElement("span",{class:"status-circle"})," ",r.a.createElement("p",null,"Offline")))))),r.a.createElement("div",{id:"search"}),r.a.createElement("div",{id:"contacts"},r.a.createElement("ul",null,g.map((function(e){return r.a.createElement("li",{onClick:function(){return y(e)},class:v&&e.id===v.id?"contact active":"contact"},r.a.createElement("div",{class:"wrap"},r.a.createElement("span",{class:"contact-status online"}),r.a.createElement("img",{id:e.id,src:e.profilePicture,alt:""}),r.a.createElement("div",{class:"meta"},r.a.createElement("p",{class:"name"},e.name),void 0!==e.newMessages&&e.newMessages>0&&r.a.createElement("p",{class:"preview"},e.newMessages," new messages"))))})))),r.a.createElement("div",{id:"bottom-bar"},r.a.createElement("button",{id:"addcontact"},r.a.createElement("i",{class:"fa fa-user fa-fw","aria-hidden":"true"})," ",r.a.createElement("span",null,"Profile")),r.a.createElement("button",{id:"settings"},r.a.createElement("i",{class:"fa fa-cog fa-fw","aria-hidden":"true"})," ",r.a.createElement("span",null,"Settings")))),r.a.createElement("div",{class:"content"},r.a.createElement("div",{class:"contact-profile"},r.a.createElement("img",{src:v&&v.profilePicture,alt:""}),r.a.createElement("p",null,v&&v.name)),r.a.createElement(B.a,{className:"messages"},r.a.createElement("ul",null,k.map((function(e){return r.a.createElement("li",{class:e.senderId===t.id?"sent":"replies"},e.senderId!==t.id&&r.a.createElement("img",{src:v.profilePicture,alt:""}),r.a.createElement("p",null,e.content))})))),r.a.createElement("div",{class:"message-input"},r.a.createElement("div",{class:"wrap"},r.a.createElement("input",{name:"user_input",size:"large",placeholder:"Write your message...",value:o,onChange:function(e){return i(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(x(o),i(""))}}),r.a.createElement(f.a,{icon:r.a.createElement("i",{class:"fa fa-paper-plane","aria-hidden":"true"}),onClick:function(){x(o),i("")}})))))},q=(a(451),r.a.createContext(),function(e){return r.a.createElement("div",{className:"App"},r.a.createElement(i.a,null,r.a.createElement(m.c,null,r.a.createElement(m.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(U,e)}}),r.a.createElement(m.a,{exact:!0,path:"/login",render:function(e){return r.a.createElement(O,e)}}),r.a.createElement(m.a,{exact:!0,path:"/signup",render:function(e){return r.a.createElement(k,e)}}),r.a.createElement(m.a,{exact:!0,path:"/chat",render:function(e){return r.a.createElement(L,e)}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var M=Object(o.a)([],{key:"recoil-persist",storage:sessionStorage}),_=M.RecoilPersist,F=M.updateState;c.a.render(r.a.createElement(l.RecoilRoot,{initializeState:F},r.a.createElement(_,null),r.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[197,1,2]]]);
//# sourceMappingURL=main.3e2f78a9.chunk.js.map