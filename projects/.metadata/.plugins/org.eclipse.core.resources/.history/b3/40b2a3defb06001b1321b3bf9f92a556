<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
	xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Charge</title>
<!--Bootstrap 4 CSS-->
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!--Bootstrap 4 JavaScript-->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!--Stripe JavaScript Library-->
<script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-light pt-5">

	<!--hero section-->
	<section class="py-5">
		<div class="container">
			<div class="row">
			
					<form action="/charge" method="post" id="payment-form">
						<div class="form-row">
							<label for="card-element"> Credit or debit card </label>
							<div id="card-element">
								<!-- a Stripe Element will be inserted here. -->
							</div>

							<!-- Used to display form errors -->
							<div id="card-errors" role="alert"></div>
						</div>

						<input type="submit" class="submit" value="Submit Payment">
					</form>
					<p class="mt-5 text-muted">
						<small>An example project by Abel Morris Ben </small>
					</p>
				</div>
			</div>
		</div>
	</section>

	<!--custom javascript for handling subscription-->
	<script>
		$(function() {
			var API_KEY = $('#api-key').val();
			// Create a Stripe client.
			var stripe = Stripe(API_KEY);

			// Create an instance of Elements.
			var elements = stripe.elements();

			// Create an instance of the card Element.
			var card = elements.create('card');

			// Add an instance of the card Element into the `card-element` <div>.
			card.mount('#card-element');

			// Handle real-time validation errors from the card Element.
			card.addEventListener('change', function(event) {
				var displayError = document.getElementById('card-errors');
				if (event.error) {
					displayError.textContent = event.error.message;
				} else {
					displayError.textContent = '';
				}
			});

			// Handle form submission.
			var form = document.getElementById('payment-form');
			form.addEventListener('submit', function(event) {
				event.preventDefault();
				// handle payment
				handlePayments();
			});

			//handle card submission
			function handlePayments() {
				stripe
						.createToken(card)
						.then(
								function(result) {
									if (result.error) {
										// Inform the user if there was an error.
										var errorElement = document
												.getElementById('card-errors');
										errorElement.textContent = result.error.message;
									} else {
										// Send the token to your server.
										var token = result.token.id;
										var email = $('#email').val();
										$.post("/create-charge", {
											email : email,
											token : token
										}, function(data) {
											alert(data.details);
										}, 'json');
									}
								});
			}
		});
	</script>

</body>
</html>
